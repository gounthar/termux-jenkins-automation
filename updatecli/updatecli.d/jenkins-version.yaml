---
name: Track Jenkins LTS Version

scms:
  default:
    kind: github
    spec:
      user: "{{ .github.user }}"
      email: "{{ .github.email }}"
      owner: "{{ .github.owner }}"
      repository: "{{ .github.repository }}"
      token: "{{ requiredEnv .github.token }}"
      username: "{{ .github.username }}"
      branch: "{{ .github.branch }}"

sources:
  jenkinsLTS:
    name: "Latest Jenkins LTS Version"
    kind: jenkins
    spec:
      release: stable

  currentJenkinsVersion:
    name: "Get current Jenkins version"
    kind: yaml
    spec:
      file: ansible/inventory/group_vars/termux.yaml
      key: $.jenkins_version

conditions:
  checkJenkinsLTSVersion:
    name: "Verify Jenkins LTS version exists"
    kind: jenkins
    sourceid: jenkinsLTS

targets:
  updateGroupVars:
    name: "Update Jenkins version in group_vars/termux.yaml"
    kind: yaml
    sourceid: jenkinsLTS
    spec:
      file: ansible/inventory/group_vars/termux.yaml
      key: $.jenkins_version
    scmid: default

actions:
  default:
    kind: github/pullrequest
    scmid: default
    title: 'chore(deps): update Jenkins LTS to {{ source "jenkinsLTS" }}'
    spec:
      labels:
        - dependencies
        - jenkins
        - automation
      description: |
        ## Jenkins LTS Update

        This PR updates Jenkins LTS version from **{{ source "currentJenkinsVersion" }}** to **{{ source "jenkinsLTS" }}**.

        ### What's Changed
        - Update `jenkins_version` in `ansible/inventory/group_vars/termux.yaml`
        - Jenkins LTS version tracked from [official updates feed](https://updates.jenkins.io/tiers.json)

        ### Testing
        After merging, verify the new Jenkins version:
        ```bash
        ansible-playbook -i ansible/inventory/hosts.yaml ansible/playbooks/02-install-jenkins.yaml
        ```

        ---
        *This PR was automatically generated by [UpdateCLI](https://www.updatecli.io/)*
