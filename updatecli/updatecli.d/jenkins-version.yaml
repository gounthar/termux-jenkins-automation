---
name: Track Jenkins LTS Version

scms:
  default:
    kind: github
    spec:
      user: "{{ .github.user }}"
      email: "{{ .github.email }}"
      owner: "{{ .github.owner }}"
      repository: "{{ .github.repository }}"
      token: "{{ requiredEnv .github.token }}"
      username: "{{ .github.username }}"
      branch: "{{ .github.branch }}"

sources:
  jenkinsLTS:
    name: "Latest Jenkins LTS Version"
    kind: json
    spec:
      file: https://updates.jenkins.io/tiers.json
      key: "stableCores.[0]"

conditions:
  checkJenkinsLTSVersion:
    name: "Verify Jenkins LTS version exists"
    kind: jenkins
    sourceid: jenkinsLTS

targets:
  updateGroupVars:
    name: "Update Jenkins version in group_vars/termux.yaml"
    kind: yaml
    sourceid: jenkinsLTS
    spec:
      file: ansible/inventory/group_vars/termux.yaml
      key: jenkins_version
    scmid: default

actions:
  default:
    kind: github/pullrequest
    scmid: default
    title: 'chore(deps): update Jenkins LTS to {{ source "jenkinsLTS" }}'
    spec:
      labels:
        - dependencies
        - jenkins
        - automation
      description: |
        ## Jenkins LTS Update

        This PR updates Jenkins LTS version from the current version to **{{ source "jenkinsLTS" }}**.

        ### Changes
        - Updated `jenkins_version` in `ansible/inventory/group_vars/termux.yaml`
        - Jenkins WAR URL automatically uses the new version via template

        ### Release Information
        - **Release**: [Jenkins {{ source "jenkinsLTS" }}](https://github.com/jenkinsci/jenkins/releases/tag/jenkins-{{ source "jenkinsLTS" }})
        - **Download URL**: https://get.jenkins.io/war-stable/{{ source "jenkinsLTS" }}/jenkins.war
        - **Changelog**: https://www.jenkins.io/changelog-stable/

        ### Testing
        To test this update on a Termux device:
        ```bash
        # Run the complete setup playbook
        ansible-playbook -i ansible/inventory/hosts.yaml ansible/playbooks/99-complete-setup.yaml

        # Or just update Jenkins
        ansible-playbook -i ansible/inventory/hosts.yaml ansible/playbooks/02-install-jenkins.yaml
        ```

        ### Verification
        After deployment, verify the Jenkins version:
        ```bash
        ssh -p 8022 termux@<device-ip> "java -jar $HOME/.jenkins/jenkins.war --version"
        ```

        ---
        ðŸ¤– This PR was automatically generated by UpdateCLI
