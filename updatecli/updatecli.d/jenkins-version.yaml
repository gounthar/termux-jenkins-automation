---
name: Track Jenkins LTS Version

scms:
  default:
    kind: github
    spec:
      user: "{{ .github.user }}"
      email: "{{ .github.email }}"
      owner: "{{ .github.owner }}"
      repository: "{{ .github.repository }}"
      token: "{{ requiredEnv .github.token }}"
      username: "{{ .github.username }}"
      branch: "{{ .github.branch }}"

sources:
  jenkinsLTS:
    name: "Latest Jenkins LTS Version"
    kind: json
    spec:
      file: https://updates.jenkins.io/tiers.json
      key: "stableCores.[0]"

conditions:
  checkJenkinsLTSVersion:
    name: "Verify Jenkins LTS version exists"
    kind: jenkins
    sourceid: jenkinsLTS

targets:
  updateGroupVars:
    name: "Update Jenkins version in group_vars/termux.yaml"
    kind: yaml
    sourceid: jenkinsLTS
    spec:
      file: ansible/inventory/group_vars/termux.yaml
      key: $.jenkins_version
    scmid: default

actions:
  default:
    kind: github/pullrequest
    scmid: default
    title: 'chore(deps): update Jenkins LTS to {{ source "jenkinsLTS" }}'
    spec:
      labels:
        - dependencies
        - jenkins
        - automation
