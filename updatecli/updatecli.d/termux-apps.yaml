---
name: Track Termux Application Versions

scms:
  default:
    kind: github
    spec:
      user: "{{ .github.user }}"
      email: "{{ .github.email }}"
      owner: "{{ .github.owner }}"
      repository: "{{ .github.repository }}"
      token: "{{ requiredEnv .github.token }}"
      username: "{{ .github.username }}"
      branch: "{{ .github.branch }}"

sources:
  termuxApp:
    name: "Latest Termux App Version"
    kind: githubrelease
    spec:
      owner: "termux"
      repository: "termux-app"
      token: "{{ requiredEnv .github.token }}"
      versionfilter:
        kind: semver
        pattern: "~0"  # Match any 0.x.x version, exclude pre-releases

  termuxAPI:
    name: "Latest Termux:API Version"
    kind: githubrelease
    spec:
      owner: "termux"
      repository: "termux-api"
      token: "{{ requiredEnv .github.token }}"
      versionfilter:
        kind: semver
        pattern: "~0"  # Match any 0.x.x version, exclude pre-releases

  termuxBoot:
    name: "Latest Termux:Boot Version"
    kind: githubrelease
    spec:
      owner: "termux"
      repository: "termux-boot"
      token: "{{ requiredEnv .github.token }}"
      versionfilter:
        kind: semver
        pattern: "~0"  # Match any 0.x.x version, exclude pre-releases

conditions:
  checkTermuxApp:
    name: "Verify Termux App release exists"
    kind: githubrelease
    sourceid: termuxApp
    spec:
      owner: "termux"
      repository: "termux-app"
      token: "{{ requiredEnv .github.token }}"

  checkTermuxAPI:
    name: "Verify Termux:API release exists"
    kind: githubrelease
    sourceid: termuxAPI
    spec:
      owner: "termux"
      repository: "termux-api"
      token: "{{ requiredEnv .github.token }}"

  checkTermuxBoot:
    name: "Verify Termux:Boot release exists"
    kind: githubrelease
    sourceid: termuxBoot
    spec:
      owner: "termux"
      repository: "termux-boot"
      token: "{{ requiredEnv .github.token }}"

targets:
  updateTermuxAppInReadme:
    name: "Update Termux App version in README.md"
    kind: file
    sourceid: termuxApp
    spec:
      file: README.md
      matchpattern: '(\[GitHub Releases\]\(https://github.com/termux/termux-app/releases\)) \(Latest: \[v[^\]]+\]\(https://github.com/termux/termux-app/releases/tag/v[^\)]+\)\)'
      replacepattern: '$1 (Latest: [{{ source "termuxApp" }}](https://github.com/termux/termux-app/releases/tag/{{ source "termuxApp" }}))'
    scmid: default

  updateTermuxAPIInReadme:
    name: "Update Termux:API version in README.md"
    kind: file
    sourceid: termuxAPI
    spec:
      file: README.md
      matchpattern: '(\[GitHub\]\(https://github.com/termux/termux-api/releases\)) \(Latest: \[v[^\]]+\]\(https://github.com/termux/termux-api/releases/tag/v[^\)]+\)\)'
      replacepattern: '$1 (Latest: [{{ source "termuxAPI" }}](https://github.com/termux/termux-api/releases/tag/{{ source "termuxAPI" }}))'
    scmid: default

  updateTermuxBootInReadme:
    name: "Update Termux:Boot version in README.md"
    kind: file
    sourceid: termuxBoot
    spec:
      file: README.md
      matchpattern: '(\[GitHub\]\(https://github.com/termux/termux-boot/releases\)) \(Latest: \[v[^\]]+\]\(https://github.com/termux/termux-boot/releases/tag/v[^\)]+\)\)'
      replacepattern: '$1 (Latest: [{{ source "termuxBoot" }}](https://github.com/termux/termux-boot/releases/tag/{{ source "termuxBoot" }}))'
    scmid: default

actions:
  default:
    kind: github/pullrequest
    scmid: default
    title: 'docs(deps): update Termux application versions in README'
    spec:
      labels:
        - dependencies
        - documentation
        - automation
      description: |
        ## Termux Application Version Updates

        This PR updates the Termux application version references in README.md.

        ### What's Changed
        - **Termux App**: [{{ source "termuxApp" }}](https://github.com/termux/termux-app/releases/tag/{{ source "termuxApp" }})
        - **Termux:API**: [{{ source "termuxAPI" }}](https://github.com/termux/termux-api/releases/tag/{{ source "termuxAPI" }})
        - **Termux:Boot**: [{{ source "termuxBoot" }}](https://github.com/termux/termux-boot/releases/tag/{{ source "termuxBoot" }})

        ### Why This Matters
        - Users can see the exact versions tested and recommended
        - Direct links to specific releases for easy downloading
        - Automated tracking ensures documentation stays current

        ### Testing
        Verify the links work correctly:
        - Check that version numbers render properly in README.md
        - Confirm GitHub release links are accessible
        - Validate that F-Droid links still work (maintained separately)

        ---
        *This PR was automatically generated by [UpdateCLI](https://www.updatecli.io/)*
